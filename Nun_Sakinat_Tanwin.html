<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Règles de Tajweed - Tanwin & Nun Sakinah</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2E7D32;
            --text-color: #333;
            --bg-color: #f5f5f5;
            --card-bg: #fff;
            --shadow: 0 4px 8px rgba(0,0,0,0.1);
            --border-radius: 8px;
            --transition: all 0.3s ease;
            --verse-font-size: 2rem;
            --arabic-font-size: 1.8rem;
        }

        .dark-mode {
            --primary-color: #689F38;
            --secondary-color: #33691E;
            --text-color: #f5f5f5;
            --bg-color: #121212;
            --card-bg: #1E1E1E;
            --shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: var(--transition);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .dark-mode header {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        h1 {
            color: var(--primary-color);
            font-size: 2rem;
        }

        .controls {
            display: flex;
            gap: 15px;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: var(--border-radius);
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 30px;
            transition: var(--transition);
        }

        h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .rule-card {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .rule-item {
            padding: 15px;
            border-left: 4px solid var(--primary-color);
            background-color: rgba(76, 175, 80, 0.1);
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }

        .rule-item h3 {
            color: var(--secondary-color);
            margin-bottom: 8px;
        }

        .quiz-container {
            display: none;
        }

        .quiz-question {
            margin-bottom: 20px;
        }

        .verse {
            font-size: var(--verse-font-size);
            text-align: center;
            margin: 20px 0;
            direction: rtl;
            font-family: 'Traditional Arabic', 'Arial', sans-serif;
        }

        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .option {
            padding: 12px;
            background-color: var(--card-bg);
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .option:hover {
            border-color: var(--primary-color);
        }

        .option.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .feedback {
            margin: 20px 0;
            padding: 15px;
            border-radius: var(--border-radius);
            display: none;
        }

        .correct {
            background-color: rgba(76, 175, 80, 0.2);
            border-left: 4px solid var(--primary-color);
        }

        .incorrect {
            background-color: rgba(244, 67, 54, 0.2);
            border-left: 4px solid #F44336;
        }

        .quiz-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .score {
            text-align: center;
            font-size: 1.2rem;
            margin: 20px 0;
            font-weight: bold;
        }

        .hidden {
            display: none;
        }

        /* Styles pour la bulle de quiz */
        .quiz-bubble {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background-color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
            transition: var(--transition);
        }

        .quiz-bubble:hover {
            transform: scale(1.1);
        }

        .quiz-bubble-icon {
            color: white;
            font-size: 1.5rem;
        }

        .quiz-popup {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 350px;
            max-height: 500px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            z-index: 1000;
            display: none;
            flex-direction: column;
            overflow-y: auto;
        }

        .quiz-popup.active {
            display: flex;
        }

        .quiz-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .close-popup {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--text-color);
        }

        /* Styles pour les exercices */
        .exercise {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(76, 175, 80, 0.05);
            border-radius: var(--border-radius);
        }

        .exercise h4 {
            margin-bottom: 10px;
            color: var(--secondary-color);
        }

        .exercise-question {
            margin-bottom: 10px;
        }

        .exercise-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .exercise-option {
            padding: 8px;
            background-color: var(--card-bg);
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .exercise-option:hover {
            border-color: var(--primary-color);
        }

        .exercise-option.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .exercise-feedback {
            margin-top: 10px;
            padding: 8px;
            border-radius: var(--border-radius);
            display: none;
        }

        .exercise-correct {
            background-color: rgba(76, 175, 80, 0.2);
            border-left: 3px solid var(--primary-color);
        }

        .exercise-incorrect {
            background-color: rgba(244, 67, 54, 0.2);
            border-left: 3px solid #F44336;
        }

        .check-answers {
            margin-top: 15px;
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
        }

        .check-answers:hover {
            background-color: var(--secondary-color);
        }

        /* Styles pour l'analyseur de tanwin */
        #arabic-input {
            width: 100%;
            padding: 10px;
            font-size: var(--arabic-font-size);
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            direction: rtl;
            font-family: 'Traditional Arabic', 'Arial', sans-serif;
        }

        #analyze-btn {
            width: 100%;
            padding: 10px;
            font-size: 16px;
        }

        #analysis-results {
            background-color: rgba(76, 175, 80, 0.1);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 15px;
        }

        #results-content {
            margin-top: 10px;
        }

        .tanwin-result {
            padding: 10px;
            margin-bottom: 10px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
        }

        .tanwin-type {
            font-weight: bold;
            color: var(--secondary-color);
        }

        .rule-explanation {
            font-style: italic;
            margin-top: 5px;
            color: var(--text-color);
        }

        .visual-representation {
            margin: 10px 0;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            font-family: 'Traditional Arabic', 'Arial', sans-serif;
            font-size: 1.5rem;
            text-align: center;
            direction: rtl;
        }

        .tanwin-visualization {
            font-size: 1.8rem;
            margin: 10px 0;
            text-align: center;
            direction: rtl;
            font-family: 'Traditional Arabic', 'Arial', sans-serif;
        }

        @media (max-width: 768px) {
            :root {
                --verse-font-size: 1.5rem;
                --arabic-font-size: 1.4rem;
            }

            header {
                flex-direction: column;
                gap: 15px;
            }
            
            .controls {
                width: 100%;
                justify-content: center;
            }
            
            .options {
                grid-template-columns: 1fr;
            }

            .quiz-popup {
                width: 90%;
                right: 5%;
                bottom: 80px;
            }

            .visual-representation {
                font-size: 1.2rem;
            }

            .tanwin-visualization {
                font-size: 1.4rem;
            }
        }

        @media (max-width: 480px) {
            :root {
                --verse-font-size: 1.3rem;
                --arabic-font-size: 1.2rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.3rem;
            }

            .rule-item h3 {
                font-size: 1.1rem;
            }

            .visual-representation {
                font-size: 1rem;
            }

            .tanwin-visualization {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 id="title">Règles de Tajweed - Tanwin & Nun Sakinah</h1>
            <div class="controls">
                <button id="language-btn">العربية</button>
                <button id="dark-mode-btn">Mode Sombre</button>
            </div>
        </header>

        <div class="card">
            <h2 id="lessons-title">Leçons sur les Règles</h2>
            <div class="rule-card">
                <div class="rule-item">
                    <h3 id="rule1-title">1. Al-Izhar Al-Halqi (الإظهار الحلقي)</h3>
                    <p id="rule1-desc">Lorsque après le tanwin ou le nun sakinah vient l'une des lettres de la gorge (ء، ه، ع، ح، غ، خ), on prononce clairement le "n" sans assimilation. Cette règle s'appelle "Izhar" qui signifie "montrer clairement". Les lettres concernées sont appelées "lettres de la gorge" car elles sont prononcées depuis différentes parties de la gorge.</p>
                    
                    <div class="tanwin-visualization" id="rule1-visual-fr">
                        <p><strong>Représentation du tanwin :</strong> Dans le cas d'Al-Izhar, le tanwin est écrit normalement avec ses deux traits alignés (ـًـٍـٌ) car il n'y a pas de fusion ou de modification du son. Le nun sakinah (نْ) est écrit avec un soukoun clair au-dessus.</p>
                        <p>Exemple avec tanwin : عَلِيٌّ حَكِيمٌ (les deux traits du tanwin sont alignés)</p>
                        <p>Exemple avec nun sakinah : مِنْ خَيْرٍ (le soukoun est clairement visible sur le ن)</p>
                    </div>
                    
                    <div class="tanwin-visualization" id="rule1-visual-ar" style="display: none;">
                        <p><strong>تمثيل التنوين:</strong> في حالة الإظهار الحلقي، يتم كتابة التنوين بشكل طبيعي بخطين متوازيين (ـًـٍـٌ) لأنه لا يوجد دمج أو تعديل في الصوت. النون الساكنة (نْ) مكتوبة بسكون واضح فوقها.</p>
                        <p>مثال مع التنوين: عَلِيٌّ حَكِيمٌ (الخطان للتنوين متوازيان)</p>
                        <p>مثال مع النون الساكنة: مِنْ خَيْرٍ (السكون واضح على النون)</p>
                    </div>
                    
                    <div class="exercise">
                        <h4 id="exercise1-title">Exercice 1: Al-Izhar Al-Halqi</h4>
                        <div class="exercise-question" id="exercise1-q1">Quelle lettre suit le tanwin dans "مِنْ خَيْرٍ" et quelle règle s'applique?</div>
                        <div class="exercise-options" id="exercise1-options1">
                            <div class="exercise-option" data-correct="false">ب - Al-Iqlab</div>
                            <div class="exercise-option" data-correct="true">خ - Al-Izhar Al-Halqi</div>
                            <div class="exercise-option" data-correct="false">ي - Al-Idgham Ma'al Ghunna</div>
                        </div>
                        <div class="exercise-feedback"></div>
                        
                        <div class="exercise-question" id="exercise1-q2">Dans "عَلِيٌّ حَكِيمٌ", comment sont représentés les deux traits du tanwin avant le ح?</div>
                        <div class="exercise-options" id="exercise1-options2">
                            <div class="exercise-option" data-correct="false">Ils sont fusionnés en un seul trait</div>
                            <div class="exercise-option" data-correct="true">Ils sont alignés normalement</div>
                            <div class="exercise-option" data-correct="false">Un trait est plus haut que l'autre</div>
                        </div>
                        <div class="exercise-feedback"></div>
                        
                        <div class="exercise-question" id="exercise1-q3">Quelles sont les lettres de Al-Izhar Al-Halqi?</div>
                        <div class="exercise-options" id="exercise1-options3">
                            <div class="exercise-option" data-correct="false">ي، ن، م، و</div>
                            <div class="exercise-option" data-correct="true">ء، ه، ع، ح، غ، خ</div>
                            <div class="exercise-option" data-correct="false">ت، ث، ج، د، ذ</div>
                        </div>
                        <div class="exercise-feedback"></div>
                        
                        <button class="check-answers" id="exercise1-check">Vérifier les réponses</button>
                    </div>
                </div>
                
                <div class="rule-item">
                    <h3 id="rule2-title">2. Al-Idgham Ma'al Ghunna (الإدغام بغنة)</h3>
                    <p id="rule2-desc">Lorsque après le tanwin ou le nun sakinah vient l'une des lettres (ي، ن، م، و), on assimile en prononçant avec une nasalisation (ghunna). La ghunna est un son nasal qui dure environ 2 temps. L'idgham signifie "fusion" ou "assimilation". Les lettres concernées peuvent être mémorisées avec le mot "يَنْمُو" (il grandit).</p>
                    
                    <div class="tanwin-visualization" id="rule2-visual-fr">
                        <p><strong>Représentation du tanwin :</strong> Dans Al-Idgham Ma'al Ghunna, le tanwin n'est pas écrit avec ses deux traits alignés. Les deux traits sont légèrement décalés pour indiquer la fusion avec nasalisation. Le nun sakinah (نْ) est complètement assimilé et n'apparaît pas visuellement, mais la nasalisation est présente dans la prononciation.</p>
                        <p>Exemple avec tanwin : غفورٌ رحيم (les traits du tanwin sont légèrement décalés avant le ر)</p>
                        <p>Exemple avec nun sakinah : مِنْ نِعْمَةٍ (le ن est assimilé dans le ن suivant avec ghunna)</p>
                    </div>
                    
                    <div class="tanwin-visualization" id="rule2-visual-ar" style="display: none;">
                        <p><strong>تمثيل التنوين:</strong> في الإدغام بغنة، لا يتم كتابة التنوين بخطين متوازيين. يتم كتابة الخطين بشكل متباعد قليلاً للإشارة إلى الدمج مع الغنة. النون الساكنة (نْ) يتم دمجها بالكامل ولا تظهر مرئيًا، لكن الغنة موجودة في النطق.</p>
                        <p>مثال مع التنوين: غفورٌ رحيم (خطا التنوين متباعدان قليلاً قبل الراء)</p>
                        <p>مثال مع النون الساكنة: مِنْ نِعْمَةٍ (النون تندمج في النون التالية مع غنة)</p>
                    </div>
                    
                    <div class="exercise">
                        <h4 id="exercise2-title">Exercice 2: Al-Idgham Ma'al Ghunna</h4>
                        <div class="exercise-question" id="exercise2-q1">Quelle règle s'applique dans "مِنْ نِعْمَةٍ"?</div>
                        <div class="exercise-options" id="exercise2-options1">
                            <div class="exercise-option" data-correct="false">Al-Izhar</div>
                            <div class="exercise-option" data-correct="true">Al-Idgham Ma'al Ghunna</div>
                            <div class="exercise-option" data-correct="false">Al-Iqlab</div>
                        </div>
                        <div class="exercise-feedback"></div>
                        
                        <div class="exercise-question" id="exercise2-q2">Comment sont représentés les traits du tanwin dans Al-Idgham Ma'al Ghunna?</div>
                        <div class="exercise-options" id="exercise2-options2">
                            <div class="exercise-option" data-correct="false">Alignés normalement comme en Izhar</div>
                            <div class="exercise-option" data-correct="true">Légèrement décalés pour indiquer la fusion</div>
                            <div class="exercise-option" data-correct="false">Remplacés par un seul trait</div>
                        </div>
                        <div class="exercise-feedback"></div>
                        
                        <div class="exercise-question" id="exercise2-q3">Quelle lettre parmi celles-ci ne fait PAS partie de Al-Idgham Ma'al Ghunna?</div>
                        <div class="exercise-options" id="exercise2-options3">
                            <div class="exercise-option" data-correct="false">ي</div>
                            <div class="exercise-option" data-correct="false">ن</div>
                            <div class="exercise-option" data-correct="true">ل</div>
                        </div>
                        <div class="exercise-feedback"></div>
                        
                        <button class="check-answers" id="exercise2-check">Vérifier les réponses</button>
                    </div>
                </div>
                
                <div class="rule-item">
                    <h3 id="rule3-title">3. Al-Idgham Bila Ghunna (الإدغام بلا غنة)</h3>
                    <p id="rule3-desc">Lorsque après le tanwin ou le nun sakinah vient l'une des lettres (ل، ر), on assimile sans nasalisation. "Bila Ghunna" signifie "sans nasalisation". Ces deux lettres sont appelées "les lettres lumineuses" (حروف مضيئة). Contrairement à Al-Idgham Ma'al Ghunna, ici l'assimilation est complète sans trace de nasalisation.</p>
                    
                    <div class="tanwin-visualization" id="rule3-visual-fr">
                        <p><strong>Représentation du tanwin :</strong> Dans Al-Idgham Bila Ghunna, le tanwin n'est pas écrit du tout car il y a assimilation complète sans nasalisation. Le nun sakinah (نْ) est également complètement assimilé et ne laisse aucune trace dans l'écriture ou la prononciation.</p>
                        <p>Exemple avec tanwin : غفورٌ رحيم (le tanwin disparaît complètement avant le ر)</p>
                        <p>Exemple avec nun sakinah : مِنْ لَدُنْ (le ن est complètement assimilé dans le ل suivant)</p>
                    </div>
                    
                    <div class="tanwin-visualization" id="rule3-visual-ar" style="display: none;">
                        <p><strong>تمثيل التنوين:</strong> في الإدغام بلا غنة، لا يتم كتابة التنوين على الإطلاق لأن هناك دمجًا كاملاً بدون غنة. النون الساكنة (نْ) يتم دمجها بالكامل ولا تترك أي أثر في الكتابة أو النطق.</p>
                        <p>مثال مع التنوين: غفورٌ رحيم (يختفي التنوين تمامًا قبل الراء)</p>
                        <p>مثال مع النون الساكنة: مِنْ لَدُنْ (النون تندمج تمامًا في اللام التالية)</p>
                    </div>
                    
                    <div class="exercise">
                        <h4 id="exercise3-title">Exercice 3: Al-Idgham Bila Ghunna</h4>
                        <div class="exercise-question" id="exercise3-q1">Quelle règle s'applique dans "مِنْ رَبِّهِمْ"?</div>
                        <div class="exercise-options" id="exercise3-options1">
                            <div class="exercise-option" data-correct="false">Al-Ikhfa'</div>
                            <div class="exercise-option" data-correct="true">Al-Idgham Bila Ghunna</div>
                            <div class="exercise-option" data-correct="false">Al-Izhar</div>
                        </div>
                        <div class="exercise-feedback"></div>
                        
                        <div class="exercise-question" id="exercise3-q2">Comment est représenté le tanwin dans Al-Idgham Bila Ghunna?</div>
                        <div class="exercise-options" id="exercise3-options2">
                            <div class="exercise-option" data-correct="false">Avec deux traits alignés</div>
                            <div class="exercise-option" data-correct="false">Avec deux traits légèrement décalés</div>
                            <div class="exercise-option" data-correct="true">Il n'apparaît pas du tout</div>
                        </div>
                        <div class="exercise-feedback"></div>
                        
                        <div class="exercise-question" id="exercise3-q3">Quelles sont les lettres de Al-Idgham Bila Ghunna?</div>
                        <div class="exercise-options" id="exercise3-options3">
                            <div class="exercise-option" data-correct="false">ي، و</div>
                            <div class="exercise-option" data-correct="true">ل، ر</div>
                            <div class="exercise-option" data-correct="false">م، ن</div>
                        </div>
                        <div class="exercise-feedback"></div>
                        
                        <button class="check-answers" id="exercise3-check">Vérifier les réponses</button>
                    </div>
                </div>
                
                <div class="rule-item">
                    <h3 id="rule4-title">4. Al-Iqlab (الإقلاب)</h3>
                    <p id="rule4-desc">Lorsque après le tanwin ou le nun sakinah vient la lettre (ب), on transforme le "n" en "m" avec nasalisation. Iqlab signifie "transformation" ou "renversement". La nasalisation (ghunna) doit durer environ 2 temps. C'est la seule règle où le son du nun sakinah ou tanwin est complètement transformé en un autre son.</p>
                    
                    <div class="tanwin-visualization" id="rule4-visual-fr">
                        <p><strong>Représentation du tanwin :</strong> Dans Al-Iqlab, le tanwin est remplacé par une petite م écrite au-dessus de la ligne (ـًۢ). Pour le nun sakinah, le نْ est transformé en مْ mais cette transformation n'est pas visible dans l'écriture ordinaire du Coran, seulement dans la prononciation.</p>
                        <p>Exemple avec tanwin : سَمِيعٌۢ بَصِيرٌ (le tanwin est remplacé par une petite م avant le ب)</p>
                        <p>Exemple avec nun sakinah : مِنْ بَعْدِ (le ن est prononcé comme م mais écrit normalement)</p>
                    </div>
                    
                    <div class="tanwin-visualization" id="rule4-visual-ar" style="display: none;">
                        <p><strong>تمثيل التنوين:</strong> في الإقلاب، يتم استبدال التنوين بميم صغيرة مكتوبة فوق السطر (ـًۢ). بالنسبة للنون الساكنة، يتم تحويل النون إلى ميم ولكن هذا التحويل غير مرئي في الكتابة العادية للقرآن، فقط في النطق.</p>
                        <p>مثال مع التنوين: سَمِيعٌۢ بَصِيرٌ (يتم استبدال التنوين بميم صغيرة قبل الباء)</p>
                        <p>مثال مع النون الساكنة: مِنْ بَعْدِ (النون تنطق كميم ولكن تكتب بشكل طبيعي)</p>
                    </div>
                    
                    <div class="exercise">
                        <h4 id="exercise4-title">Exercice 4: Al-Iqlab</h4>
                        <div class="exercise-question" id="exercise4-q1">Quelle règle s'applique dans "مِنْ بَعْدِ"?</div>
                        <div class="exercise-options" id="exercise4-options1">
                            <div class="exercise-option" data-correct="false">Al-Ikhfa'</div>
                            <div class="exercise-option" data-correct="true">Al-Iqlab</div>
                            <div class="exercise-option" data-correct="false">Al-Idgham</div>
                        </div>
                        <div class="exercise-feedback"></div>
                        
                        <div class="exercise-question" id="exercise4-q2">Comment est représenté le tanwin dans Al-Iqlab?</div>
                        <div class="exercise-options" id="exercise4-options2">
                            <div class="exercise-option" data-correct="false">Avec deux traits alignés</div>
                            <div class="exercise-option" data-correct="true">Remplacé par une petite م au-dessus</div>
                            <div class="exercise-option" data-correct="false">Avec deux traits décalés</div>
                        </div>
                        <div class="exercise-feedback"></div>
                        
                        <div class="exercise-question" id="exercise4-q3">Quelle lettre déclenche Al-Iqlab?</div>
                        <div class="exercise-options" id="exercise4-options3">
                            <div class="exercise-option" data-correct="false">ت</div>
                            <div class="exercise-option" data-correct="true">ب</div>
                            <div class="exercise-option" data-correct="false">ج</div>
                        </div>
                        <div class="exercise-feedback"></div>
                        
                        <button class="check-answers" id="exercise4-check">Vérifier les réponses</button>
                    </div>
                </div>
                
                <div class="rule-item">
                    <h3 id="rule5-title">5. Al-Ikhfa' Al-Haqiqi (الإخفاء الحقيقي)</h3>
                    <p id="rule5-desc">Lorsque après le tanwin ou le nun sakinah vient l'une des 15 lettres restantes, on prononce avec un son intermédiaire entre l'assimilation et la clarté, avec nasalisation. Ikhfa' signifie "dissimulation". Les 15 lettres sont: ت، ث، ج، د، ذ، ز، س، ش، ص، ض، ط، ظ، ف، ق، ك. La nasalisation doit durer environ 2 temps et le son doit être produit avec le bout de la langue près des dents supérieures sans toucher.</p>
                    
                    <div class="tanwin-visualization" id="rule5-visual-fr">
                        <p><strong>Représentation du tanwin :</strong> Dans Al-Ikhfa', le tanwin est écrit avec ses deux traits mais ils peuvent apparaître légèrement estompés ou moins marqués pour indiquer la prononciation cachée. Le nun sakinah (نْ) conserve son soukoun mais la prononciation est nasalisée et cachée.</p>
                        <p>Exemple avec tanwin : عَلِيمٌ ذُو (les traits du tanwin sont présents mais la prononciation est cachée)</p>
                        <p>Exemple avec nun sakinah : مِنْ تَحْتِهَا (le ن conserve son soukoun mais la prononciation est nasalisée)</p>
                    </div>
                    
                    <div class="tanwin-visualization" id="rule5-visual-ar" style="display: none;">
                        <p><strong>تمثيل التنوين:</strong> في الإخفاء، يتم كتابة التنوين بخطيه ولكن قد يظهران باهتين أو أقل وضوحًا للإشارة إلى النطق المخفي. النون الساكنة (نْ) تحتفظ بسكونها ولكن النطق يكون أنفيًا ومخفيًا.</p>
                        <p>مثال مع التنوين: عَلِيمٌ ذُو (خطا التنوين موجودان ولكن النطق مخفي)</p>
                        <p>مثال مع النون الساكنة: مِنْ تَحْتِهَا (النون تحتفظ بسكونها ولكن النطق أنفي)</p>
                    </div>
                    
                    <div class="exercise">
                        <h4 id="exercise5-title">Exercice 5: Al-Ikhfa' Al-Haqiqi</h4>
                        <div class="exercise-question" id="exercise5-q1">Quelle règle s'applique dans "مِنْ تَحْتِهَا"?</div>
                        <div class="exercise-options" id="exercise5-options1">
                            <div class="exercise-option" data-correct="false">Al-Izhar</div>
                            <div class="exercise-option" data-correct="true">Al-Ikhfa'</div>
                            <div class="exercise-option" data-correct="false">Al-Iqlab</div>
                        </div>
                        <div class="exercise-feedback"></div>
                        
                        <div class="exercise-question" id="exercise5-q2">Comment est représenté le tanwin dans Al-Ikhfa'?</div>
                        <div class="exercise-options" id="exercise5-options2">
                            <div class="exercise-option" data-correct="false">Il disparaît complètement</div>
                            <div class="exercise-option" data-correct="true">Les deux traits sont présents mais moins marqués</div>
                            <div class="exercise-option" data-correct="false">Remplacé par une petite م</div>
                        </div>
                        <div class="exercise-feedback"></div>
                        
                        <div class="exercise-question" id="exercise5-q3">Quelle caractéristique est présente dans Al-Ikhfa' mais absente dans Al-Izhar?</div>
                        <div class="exercise-options" id="exercise5-options3">
                            <div class="exercise-option" data-correct="false">Prononciation claire</div>
                            <div class="exercise-option" data-correct="true">Nasalisation (ghunna)</div>
                            <div class="exercise-option" data-correct="false">Transformation du son</div>
                        </div>
                        <div class="exercise-feedback"></div>
                        
                        <button class="check-answers" id="exercise5-check">Vérifier les réponses</button>
                    </div>
                </div>
            </div>
        </div>

        <button id="start-quiz-btn" class="primary">Commencer le Quiz</button>

        <div class="quiz-container" id="quiz-container">
            <div class="score" id="score">Score: 0/0</div>
            <div class="quiz-question">
                <div class="verse" id="verse"></div>
                <div class="options" id="options"></div>
                <div class="feedback" id="feedback"></div>
            </div>
            <div class="quiz-nav">
                <button id="prev-btn" disabled>Précédent</button>
                <button id="next-btn">Suivant</button>
            </div>
        </div>

        <!-- Nouvelle section pour l'analyseur de tanwin -->
        <div class="card">
            <h2 id="analyzer-title">Analyseur de Tanwin & Nun Sakinah</h2>
            <div class="rule-item">
                <p id="analyzer-desc">Entrez une phrase en arabe contenant un tanwin (ـًـٍـٌ) ou un nun sakinah (نْ) et nous analyserons les règles qui s'appliquent:</p>
                <textarea id="arabic-input" rows="3" placeholder="اكتب جملة تحتوي على تنوين أو نون ساكنة..."></textarea>
                <button id="analyze-btn">Analyser</button>
                <div id="analysis-results" style="display: none;">
                    <h3 id="results-title">Résultats d'analyse</h3>
                    <div id="results-content"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulle de quiz -->
    <div class="quiz-bubble" id="quiz-bubble">
        <div class="quiz-bubble-icon">?</div>
    </div>

    <!-- Popup de quiz -->
    <div class="quiz-popup" id="quiz-popup">
        <div class="quiz-popup-header">
            <h3 id="popup-title">Quiz Rapide</h3>
            <button class="close-popup" id="close-popup">×</button>
        </div>
        <div id="popup-content">
            <p id="popup-question"></p>
            <div id="popup-options"></div>
            <div id="popup-feedback" class="exercise-feedback"></div>
            <div class="quiz-nav">
                <button id="popup-prev" disabled>Précédent</button>
                <button id="popup-next">Suivant</button>
            </div>
            <div id="popup-score" class="score"></div>
        </div>
    </div>

    <script>
        // Données bilingues
        const translations = {
            fr: {
                title: "Règles de Tajweed - Tanwin & Nun Sakinah",
                lessonsTitle: "Leçons sur les Règles",
                rule1Title: "1. Al-Izhar Al-Halqi (الإظهار الحلقي)",
                rule1Desc: "Lorsque après le tanwin ou le nun sakinah vient l'une des lettres de la gorge (ء، ه، ع، ح، غ، خ), on prononce clairement le 'n' sans assimilation. Cette règle s'appelle 'Izhar' qui signifie 'montrer clairement'. Les lettres concernées sont appelées 'lettres de la gorge' car elles sont prononcées depuis différentes parties de la gorge.",
                rule2Title: "2. Al-Idgham Ma'al Ghunna (الإدغام بغنة)",
                rule2Desc: "Lorsque après le tanwin ou le nun sakinah vient l'une des lettres (ي، ن، م، و), on assimile en prononçant avec une nasalisation (ghunna). La ghunna est un son nasal qui dure environ 2 temps. L'idgham signifie 'fusion' ou 'assimilation'. Les lettres concernées peuvent être mémorisées avec le mot 'يَنْمُو' (il grandit).",
                rule3Title: "3. Al-Idgham Bila Ghunna (الإدغام بلا غنة)",
                rule3Desc: "Lorsque après le tanwin ou le nun sakinah vient l'une des lettres (ل، ر), on assimile sans nasalisation. 'Bila Ghunna' signifie 'sans nasalisation'. Ces deux lettres sont appelées 'les lettres lumineuses' (حروف مضيئة). Contrairement à Al-Idgham Ma'al Ghunna, ici l'assimilation est complète sans trace de nasalisation.",
                rule4Title: "4. Al-Iqlab (الإقلاب)",
                rule4Desc: "Lorsque après le tanwin ou le nun sakinah vient la lettre (ب), on transforme le 'n' en 'm' avec nasalisation. Iqlab signifie 'transformation' ou 'renversement'. La nasalisation (ghunna) doit durer environ 2 temps. C'est la seule règle où le son du nun sakinah ou tanwin est complètement transformé en un autre son.",
                rule5Title: "5. Al-Ikhfa' Al-Haqiqi (الإخفاء الحقيقي)",
                rule5Desc: "Lorsque après le tanwin ou le nun sakinah vient l'une des 15 lettres restantes, on prononce avec un son intermédiaire entre l'assimilation et la clarté, avec nasalisation. Ikhfa' signifie 'dissimulation'. Les 15 lettres sont: ت، ث، ج، د، ذ، ز، س، ش، ص، ض، ط، ظ، ف، ق، ك. La nasalisation doit durer environ 2 temps et le son doit être produit avec le bout de la langue près des dents supérieures sans toucher.",
                startQuizBtn: "Commencer le Quiz",
                prevBtn: "Précédent",
                nextBtn: "Suivant",
                scoreText: "Score: ",
                popupTitle: "Quiz Rapide",
                exerciseCheck: "Vérifier les réponses",
                correct: "Correct!",
                incorrect: "Incorrect!",
                popupEnd: "Fin du quiz! Votre score: ",
                exercise1Title: "Exercice 1: Al-Izhar Al-Halqi",
                exercise1Q1: "Quelle lettre suit le tanwin dans \"مِنْ خَيْرٍ\" et quelle règle s'applique?",
                exercise1Q2: "Dans \"عَلِيٌّ حَكِيمٌ\", comment sont représentés les deux traits du tanwin avant le ح?",
                exercise1Q3: "Quelles sont les lettres de Al-Izhar Al-Halqi?",
                exercise1Opt1: "ب - Al-Iqlab",
                exercise1Opt2: "خ - Al-Izhar Al-Halqi",
                exercise1Opt3: "ي - Al-Idgham Ma'al Ghunna",
                exercise1Opt4: "Ils sont fusionnés en un seul trait",
                exercise1Opt5: "Ils sont alignés normalement",
                exercise1Opt6: "Un trait est plus haut que l'autre",
                exercise1Opt7: "ي، ن، م، و",
                exercise1Opt8: "ء، ه، ع، ح، غ، خ",
                exercise1Opt9: "ت، ث، ج، د، ذ",
                exercise2Title: "Exercice 2: Al-Idgham Ma'al Ghunna",
                exercise2Q1: "Quelle règle s'applique dans \"مِنْ نِعْمَةٍ\"?",
                exercise2Q2: "Comment sont représentés les traits du tanwin dans Al-Idgham Ma'al Ghunna?",
                exercise2Q3: "Quelle lettre parmi celles-ci ne fait PAS partie de Al-Idgham Ma'al Ghunna?",
                exercise2Opt1: "Al-Izhar",
                exercise2Opt2: "Al-Idgham Ma'al Ghunna",
                exercise2Opt3: "Al-Iqlab",
                exercise2Opt4: "Alignés normalement comme en Izhar",
                exercise2Opt5: "Légèrement décalés pour indiquer la fusion",
                exercise2Opt6: "Remplacés par un seul trait",
                exercise2Opt7: "ي",
                exercise2Opt8: "ن",
                exercise2Opt9: "ل",
                exercise3Title: "Exercice 3: Al-Idgham Bila Ghunna",
                exercise3Q1: "Quelle règle s'applique dans \"مِنْ رَبِّهِمْ\"?",
                exercise3Q2: "Comment est représenté le tanwin dans Al-Idgham Bila Ghunna?",
                exercise3Q3: "Quelles sont les lettres de Al-Idgham Bila Ghunna?",
                exercise3Opt1: "Al-Ikhfa'",
                exercise3Opt2: "Al-Idgham Bila Ghunna",
                exercise3Opt3: "Al-Izhar",
                exercise3Opt4: "Avec deux traits alignés",
                exercise3Opt5: "Avec deux traits légèrement décalés",
                exercise3Opt6: "Il n'apparaît pas du tout",
                exercise3Opt7: "ي، و",
                exercise3Opt8: "ل، ر",
                exercise3Opt9: "م، ن",
                exercise4Title: "Exercice 4: Al-Iqlab",
                exercise4Q1: "Quelle règle s'applique dans \"مِنْ بَعْدِ\"?",
                exercise4Q2: "Comment est représenté le tanwin dans Al-Iqlab?",
                exercise4Q3: "Quelle lettre déclenche Al-Iqlab?",
                exercise4Opt1: "Al-Ikhfa'",
                exercise4Opt2: "Al-Iqlab",
                exercise4Opt3: "Al-Idgham",
                exercise4Opt4: "Avec deux traits alignés",
                exercise4Opt5: "Remplacé par une petite م au-dessus",
                exercise4Opt6: "Avec deux traits décalés",
                exercise4Opt7: "ت",
                exercise4Opt8: "ب",
                exercise4Opt9: "ج",
                exercise5Title: "Exercice 5: Al-Ikhfa' Al-Haqiqi",
                exercise5Q1: "Quelle règle s'applique dans \"مِنْ تَحْتِهَا\"?",
                exercise5Q2: "Comment est représenté le tanwin dans Al-Ikhfa'?",
                exercise5Q3: "Quelle caractéristique est présente dans Al-Ikhfa' mais absente dans Al-Izhar?",
                exercise5Opt1: "Al-Izhar",
                exercise5Opt2: "Al-Ikhfa'",
                exercise5Opt3: "Al-Iqlab",
                exercise5Opt4: "Il disparaît complètement",
                exercise5Opt5: "Les deux traits sont présents mais moins marqués",
                exercise5Opt6: "Remplacé par une petite م",
                exercise5Opt7: "Prononciation claire",
                exercise5Opt8: "Nasalisation (ghunna)",
                exercise5Opt9: "Transformation du son",
                analyzerTitle: "Analyseur de Tanwin & Nun Sakinah",
                analyzerDesc: "Entrez une phrase en arabe contenant un tanwin (ـًـٍـٌ) ou un nun sakinah (نْ) et nous analyserons les règles qui s'appliquent:",
                resultsTitle: "Résultats d'analyse",
                noTanwinFound: "Aucun tanwin ou nun sakinah détecté dans la phrase.",
                tanwinAtPosition: "Tanwin à la position",
                nunAtPosition: "Nun sakinah à la position",
                followingLetter: "Lettre suivante",
                ruleApplied: "Règle appliquée",
                noFollowingLetter: "aucun caractère suivant (fin de mot)",
                analyzeBtn: "Analyser",
                tanwinFathah: "Tanwin Fathah (ـً)",
                tanwinKasrah: "Tanwin Kasrah (ـٍ)",
                tanwinDammah: "Tanwin Dammah (ـٌ)",
                nunSakinah: "Nun sakinah (نْ)",
                izharExplanation: "Prononciation claire du 'n' sans assimilation car la lettre suivante est une lettre de la gorge.",
                idghamWithGhunnaExplanation: "Assimilation avec nasalisation (ghunna) car la lettre suivante est l'une des lettres ي، ن، م، و.",
                idghamWithoutGhunnaExplanation: "Assimilation sans nasalisation car la lettre suivante est l'une des lettres ل، ر.",
                iqlabExplanation: "Transformation du 'n' en 'm' avec nasalisation car la lettre suivante est ب.",
                ikhfaExplanation: "Prononciation intermédiaire avec nasalisation car la lettre suivante est l'une des 15 lettres d'Ikhfa'."
            },
            ar: {
                title: "قواعد التجويد - التنوين والنون الساكنة",
                lessonsTitle: "دروس في القواعد",
                rule1Title: "١. الإظهار الحلقي",
                rule1Desc: "إذا جاء بعد التنوين أو النون الساكنة أحد حروف الحلق (ء، ه، ع، ح، غ، خ)، ينطق النون بوضوح دون إدغام. هذه القاعدة تسمى 'الإظهار' والتي تعني 'إظهار واضح'. الحروف المعنية تسمى 'حروف الحلق' لأنها تنطق من أجزاء مختلفة من الحلق.",
                rule2Title: "٢. الإدغام بغنة",
                rule2Desc: "إذا جاء بعد التنوين أو النون الساكنة أحد حروف (ي، ن، م، و)، يدغم مع الغنة. الغنة هي صوت أنفي يستمر لمدة حركتين. الإدغام يعني 'الدمج' أو 'الاستيعاب'. يمكن حفظ الحروف المعنية بكلمة 'يَنْمُو'.",
                rule3Title: "٣. الإدغام بلا غنة",
                rule3Desc: "إذا جاء بعد التنوين أو النون الساكنة أحد حرفي (ل، ر)، يدغم بدون غنة. 'بلا غنة' تعني 'بدون غنة'. هذان الحرفان يسميان 'الحروف المضيئة'. على عكس الإدغام بغنة، هنا يكون الاستيعاب كاملاً بدون أي أثر للغنة.",
                rule4Title: "٤. الإقلاب",
                rule4Desc: "إذا جاء بعد التنوين أو النون الساكنة حرف (ب)، يحول النون إلى ميم مع الغنة. الإقلاب يعني 'التحويل' أو 'القلب'. يجب أن تستمر الغنة لمدة حركتين. هذه هي القاعدة الوحيدة التي يتحول فيها صوت النون الساكنة أو التنوين تمامًا إلى صوت آخر.",
                rule5Title: "٥. الإخفاء الحقيقي",
                rule5Desc: "إذا جاء بعد التنوين أو النون الساكنة أحد الحروف الخمسة عشر الباقية، ينطق بصوت بين الإدغام والإظهار مع الغنة. الإخفاء يعني 'الإخفاء'. الحروف الخمسة عشر هي: ت، ث، ج، د، ذ، ز، س، ش، ص، ض، ط، ظ، ف، ق، ك. يجب أن تستمر الغنة لمدة حركتين ويجب إنتاج الصوت بطرف اللسان بالقرب من الأسنان العلوية دون لمسها.",
                startQuizBtn: "ابدأ الاختبار",
                prevBtn: "السابق",
                nextBtn: "التالي",
                scoreText: "النتيجة: ",
                popupTitle: "اختبار سريع",
                exerciseCheck: "تحقق من الإجابات",
                correct: "صحيح!",
                incorrect: "خطأ!",
                popupEnd: "نهاية الاختبار! نتيجتك: ",
                exercise1Title: "تمرين 1: الإظهار الحلقي",
                exercise1Q1: "ما الحرف الذي يلي التنوين في \"مِنْ خَيْرٍ\" وما هي القاعدة المطبقة?",
                exercise1Q2: "في \"عَلِيٌّ حَكِيمٌ\"، كيف يتم تمثيل شرطتي التنوين قبل الحاء?",
                exercise1Q3: "ما هي حروف الإظهار الحلقي?",
                exercise1Opt1: "ب - الإقلاب",
                exercise1Opt2: "خ - الإظهار الحلقي",
                exercise1Opt3: "ي - الإدغام بغنة",
                exercise1Opt4: "يتم دمجها في سطر واحد",
                exercise1Opt5: "يتم محاذاتها بشكل طبيعي",
                exercise1Opt6: "أحد الخطين أعلى من الآخر",
                exercise1Opt7: "ي، ن، م، و",
                exercise1Opt8: "ء، ه، ع، ح، غ، خ",
                exercise1Opt9: "ت، ث، ج، د، ذ",
                exercise2Title: "تمرين 2: الإدغام بغنة",
                exercise2Q1: "ما هي القاعدة المطبقة في \"مِنْ نِعْمَةٍ\"?",
                exercise2Q2: "كيف يتم تمثيل شرطتي التنوين في الإدغام بغنة?",
                exercise2Q3: "أي من هذه الحروف ليس جزءًا من الإدغام بغنة?",
                exercise2Opt1: "الإظهار",
                exercise2Opt2: "الإدغام بغنة",
                exercise2Opt3: "الإقلاب",
                exercise2Opt4: "محاذاة بشكل طبيعي كما في الإظهار",
                exercise2Opt5: "متباعدة قليلاً للإشارة إلى الدمج",
                exercise2Opt6: "يتم استبدالها بخط واحد",
                exercise2Opt7: "ي",
                exercise2Opt8: "ن",
                exercise2Opt9: "ل",
                exercise3Title: "تمرين 3: الإدغام بلا غنة",
                exercise3Q1: "ما هي القاعدة المطبقة في \"مِنْ رَبِّهِمْ\"?",
                exercise3Q2: "كيف يتم تمثيل التنوين في الإدغام بلا غنة?",
                exercise3Q3: "ما هي حروف الإدغام بلا غنة?",
                exercise3Opt1: "الإخفاء",
                exercise3Opt2: "الإدغام بلا غنة",
                exercise3Opt3: "الإظهار",
                exercise3Opt4: "بخطين متوازيين",
                exercise3Opt5: "بخطين متباعدين قليلاً",
                exercise3Opt6: "لا يظهر على الإطلاق",
                exercise3Opt7: "ي، و",
                exercise3Opt8: "ل، ر",
                exercise3Opt9: "م، ن",
                exercise4Title: "تمرين 4: الإقلاب",
                exercise4Q1: "ما هي القاعدة المطبقة في \"مِنْ بَعْدِ\"?",
                exercise4Q2: "كيف يتم تمثيل التنوين في الإقلاب?",
                exercise4Q3: "ما هو الحرف الذي يسبب الإقلاب?",
                exercise4Opt1: "الإخفاء",
                exercise4Opt2: "الإقلاب",
                exercise4Opt3: "الإدغام",
                exercise4Opt4: "بخطين متوازيين",
                exercise4Opt5: "يتم استبداله بميم صغيرة فوق السطر",
                exercise4Opt6: "بخطين متباعدين",
                exercise4Opt7: "ت",
                exercise4Opt8: "ب",
                exercise4Opt9: "ج",
                exercise5Title: "تمرين 5: الإخفاء الحقيقي",
                exercise5Q1: "ما هي القاعدة المطبقة في \"مِنْ تَحْتِهَا\"?",
                exercise5Q2: "كيف يتم تمثيل التنوين في الإخفاء?",
                exercise5Q3: "ما هي الخاصية الموجودة في الإخفاء ولكن غير موجودة في الإظهار?",
                exercise5Opt1: "الإظهار",
                exercise5Opt2: "الإخفاء",
                exercise5Opt3: "الإقلاب",
                exercise5Opt4: "يختفي تمامًا",
                exercise5Opt5: "يظهر الخطان ولكن بشكل أقل وضوحًا",
                exercise5Opt6: "يتم استبداله بميم صغيرة",
                exercise5Opt7: "النطق الواضح",
                exercise5Opt8: "الغنة",
                exercise5Opt9: "تحويل الصوت",
                analyzerTitle: "محلل التنوين والنون الساكنة",
                analyzerDesc: "أدخل جملة باللغة العربية تحتوي على تنوين (ـًـٍـٌ) أو نون ساكنة (نْ) وسنقوم بتحليل القواعد المطبقة:",
                resultsTitle: "نتائج التحليل",
                noTanwinFound: "لم يتم العثور على تنوين أو نون ساكنة في الجملة.",
                tanwinAtPosition: "التنوين في الموضع",
                nunAtPosition: "النون الساكنة في الموضع",
                followingLetter: "الحرف التالي",
                ruleApplied: "القاعدة المطبقة",
                noFollowingLetter: "لا يوجد حرف تالي (نهاية الكلمة)",
                analyzeBtn: "تحليل",
                tanwinFathah: "تنوين فتحة (ـً)",
                tanwinKasrah: "تنوين كسرة (ـٍ)",
                tanwinDammah: "تنوين ضمة (ـٌ)",
                nunSakinah: "نون ساكنة (نْ)",
                izharExplanation: "النطق الواضح للنون دون إدغام لأن الحرف التالي من حروف الحلق.",
                idghamWithGhunnaExplanation: "إدغام مع غنة لأن الحرف التالي أحد حروف ي، ن، م، و.",
                idghamWithoutGhunnaExplanation: "إدغام بدون غنة لأن الحرف التالي أحد حرفي ل، ر.",
                iqlabExplanation: "تحويل النون إلى ميم مع غنة لأن الحرف التالي ب.",
                ikhfaExplanation: "نطق متوسط مع غنة لأن الحرف التالي أحد حروف الإخفاء الخمسة عشر."
            }
        };

        // Règles de tanwin et nun sakinah
        const tajweedRules = {
            "ء": {
                rule: "Al-Izhar Al-Halqi (الإظهار الحلقي)",
                explanation: {
                    fr: "Prononciation claire du 'n' sans assimilation car la lettre suivante est une lettre de la gorge.",
                    ar: "النطق الواضح للنون دون إدغام لأن الحرف التالي من حروف الحلق."
                },
                visual: {
                    fr: "Le tanwin est écrit normalement avec deux traits alignés. Le nun sakinah a un soukoun clair.",
                    ar: "يتم كتابة التنوين بشكل طبيعي بخطين متوازيين. النون الساكنة لها سكون واضح."
                }
            },
            "ه": {
                rule: "Al-Izhar Al-Halqi (الإظهار الحلقي)",
                explanation: {
                    fr: "Prononciation claire du 'n' sans assimilation car la lettre suivante est une lettre de la gorge.",
                    ar: "النطق الواضح للنون دون إدغام لأن الحرف التالي من حروف الحلق."
                },
                visual: {
                    fr: "Le tanwin est écrit normalement avec deux traits alignés. Le nun sakinah a un soukoun clair.",
                    ar: "يتم كتابة التنوين بشكل طبيعي بخطين متوازيين. النون الساكنة لها سكون واضح."
                }
            },
            "ع": {
                rule: "Al-Izhar Al-Halqi (الإظهار الحلقي)",
                explanation: {
                    fr: "Prononciation claire du 'n' sans assimilation car la lettre suivante est une lettre de la gorge.",
                    ar: "النطق الواضح للنون دون إدغام لأن الحرف التالي من حروف الحلق."
                },
                visual: {
                    fr: "Le tanwin est écrit normalement avec deux traits alignés. Le nun sakinah a un soukoun clair.",
                    ar: "يتم كتابة التنوين بشكل طبيعي بخطين متوازيين. النون الساكنة لها سكون واضح."
                }
            },
            "ح": {
                rule: "Al-Izhar Al-Halqi (الإظهار الحلقي)",
                explanation: {
                    fr: "Prononciation claire du 'n' sans assimilation car la lettre suivante est une lettre de la gorge.",
                    ar: "النطق الواضح للنون دون إدغام لأن الحرف التالي من حروف الحلق."
                },
                visual: {
                    fr: "Le tanwin est écrit normalement avec deux traits alignés. Le nun sakinah a un soukoun clair.",
                    ar: "يتم كتابة التنوين بشكل طبيعي بخطين متوازيين. النون الساكنة لها سكون واضح."
                }
            },
            "غ": {
                rule: "Al-Izhar Al-Halqi (الإظهار الحلقي)",
                explanation: {
                    fr: "Prononciation claire du 'n' sans assimilation car la lettre suivante est une lettre de la gorge.",
                    ar: "النطق الواضح للنون دون إدغام لأن الحرف التالي من حروف الحلق."
                },
                visual: {
                    fr: "Le tanwin est écrit normalement avec deux traits alignés. Le nun sakinah a un soukoun clair.",
                    ar: "يتم كتابة التنوين بشكل طبيعي بخطين متوازيين. النون الساكنة لها سكون واضح."
                }
            },
            "خ": {
                rule: "Al-Izhar Al-Halqi (الإظهار الحلقي)",
                explanation: {
                    fr: "Prononciation claire du 'n' sans assimilation car la lettre suivante est une lettre de la gorge.",
                    ar: "النطق الواضح للنون دون إدغام لأن الحرف التالي من حروف الحلق."
                },
                visual: {
                    fr: "Le tanwin est écrit normalement avec deux traits alignés. Le nun sakinah a un soukoun clair.",
                    ar: "يتم كتابة التنوين بشكل طبيعي بخطين متوازيين. النون الساكنة لها سكون واضح."
                }
            },
            "ي": {
                rule: "Al-Idgham Ma'al Ghunna (الإدغام بغنة)",
                explanation: {
                    fr: "Assimilation avec nasalisation (ghunna) car la lettre suivante est l'une des lettres ي، ن، م، و.",
                    ar: "إدغام مع غنة لأن الحرف التالي أحد حروف ي، ن، م، و."
                },
                visual: {
                    fr: "Les deux traits du tanwin sont légèrement décalés pour indiquer la fusion avec nasalisation. Le nun sakinah est complètement assimilé.",
                    ar: "يتم كتابة خطي التنوين بشكل متباعد قليلاً للإشارة إلى الدمج مع الغنة. النون الساكنة يتم دمجها بالكامل."
                }
            },
            "ن": {
                rule: "Al-Idgham Ma'al Ghunna (الإدغام بغنة)",
                explanation: {
                    fr: "Assimilation avec nasalisation (ghunna) car la lettre suivante est l'une des lettres ي، ن، م، و.",
                    ar: "إدغام مع غنة لأن الحرف التالي أحد حروف ي، ن، م، و."
                },
                visual: {
                    fr: "Les deux traits du tanwin sont légèrement décalés pour indiquer la fusion avec nasalisation. Le nun sakinah est complètement assimilé.",
                    ar: "يتم كتابة خطي التنوين بشكل متباعد قليلاً للإشارة إلى الدمج مع الغنة. النون الساكنة يتم دمجها بالكامل."
                }
            },
            "م": {
                rule: "Al-Idgham Ma'al Ghunna (الإدغام بغنة)",
                explanation: {
                    fr: "Assimilation avec nasalisation (ghunna) car la lettre suivante est l'une des lettres ي، ن، م، و.",
                    ar: "إدغام مع غنة لأن الحرف التالي أحد حروف ي، ن، م، و."
                },
                visual: {
                    fr: "Les deux traits du tanwin sont légèrement décalés pour indiquer la fusion avec nasalisation. Le nun sakinah est complètement assimilé.",
                    ar: "يتم كتابة خطي التنوين بشكل متباعد قليلاً للإشارة إلى الدمج مع الغنة. النون الساكنة يتم دمجها بالكامل."
                }
            },
            "و": {
                rule: "Al-Idgham Ma'al Ghunna (الإدغام بغنة)",
                explanation: {
                    fr: "Assimilation avec nasalisation (ghunna) car la lettre suivante est l'une des lettres ي، ن، م، و.",
                    ar: "إدغام مع غنة لأن الحرف التالي أحد حروف ي، ن، م، و."
                },
                visual: {
                    fr: "Les deux traits du tanwin sont légèrement décalés pour indiquer la fusion avec nasalisation. Le nun sakinah est complètement assimilé.",
                    ar: "يتم كتابة خطي التنوين بشكل متباعد قليلاً للإشارة إلى الدمج مع الغنة. النون الساكنة يتم دمجها بالكامل."
                }
            },
            "ل": {
                rule: "Al-Idgham Bila Ghunna (الإدغام بلا غنة)",
                explanation: {
                    fr: "Assimilation sans nasalisation car la lettre suivante est l'une des lettres ل، ر.",
                    ar: "إدغام بدون غنة لأن الحرف التالي أحد حرفي ل، ر."
                },
                visual: {
                    fr: "Le tanwin disparaît complètement car il y a assimilation totale sans nasalisation. Le nun sakinah est complètement assimilé.",
                    ar: "يختفي التنوين تمامًا بسبب الدمج الكامل بدون غنة. النون الساكنة يتم دمجها بالكامل."
                }
            },
            "ر": {
                rule: "Al-Idgham Bila Ghunna (الإدغام بلا غنة)",
                explanation: {
                    fr: "Assimilation sans nasalisation car la lettre suivante est l'une des lettres ل، ر.",
                    ar: "إدغام بدون غنة لأن الحرف التالي أحد حرفي ل، ر."
                },
                visual: {
                    fr: "Le tanwin disparaît complètement car il y a assimilation totale sans nasalisation. Le nun sakinah est complètement assimilé.",
                    ar: "يختفي التنوين تمامًا بسبب الدمج الكامل بدون غنة. النون الساكنة يتم دمجها بالكامل."
                }
            },
            "ب": {
                rule: "Al-Iqlab (الإقلاب)",
                explanation: {
                    fr: "Transformation du 'n' en 'm' avec nasalisation car la lettre suivante est ب.",
                    ar: "تحويل النون إلى ميم مع غنة لأن الحرف التالي ب."
                },
                visual: {
                    fr: "Le tanwin est remplacé par une petite م écrite au-dessus de la ligne. Le nun sakinah est transformé en م mais cette transformation n'est pas visible dans l'écriture.",
                    ar: "يتم استبدال التنوين بميم صغيرة مكتوبة فوق السطر. النون الساكنة تتحول إلى ميم ولكن هذا التحول غير مرئي في الكتابة."
                }
            },
            "default": {
                rule: "Al-Ikhfa' Al-Haqiqi (الإخفاء الحقيقي)",
                explanation: {
                    fr: "Prononciation intermédiaire avec nasalisation car la lettre suivante est l'une des 15 lettres d'Ikhfa'.",
                    ar: "نطق متوسط مع غنة لأن الحرف التالي أحد حروف الإخفاء الخمسة عشر."
                },
                visual: {
                    fr: "Le tanwin est écrit avec ses deux traits mais ils peuvent apparaître légèrement estompés. Le nun sakinah conserve son soukoun mais la prononciation est nasalisée et cachée.",
                    ar: "يتم كتابة التنوين بخطيه ولكن قد يظهران باهتين قليلاً. النون الساكنة تحتفظ بسكونها ولكن النطق يكون أنفيًا ومخفيًا."
                }
            }
        };

        // Types de tanwin
        const tanwinTypes = {
            "\u064B": {
                name: {
                    fr: "Tanwin Fathah (ـً)",
                    ar: "تنوين فتحة (ـً)"
                }
            },
            "\u064D": {
                name: {
                    fr: "Tanwin Kasrah (ـٍ)",
                    ar: "تنوين كسرة (ـٍ)"
                }
            },
            "\u064C": {
                name: {
                    fr: "Tanwin Dammah (ـٌ)",
                    ar: "تنوين ضمة (ـٌ)"
                }
            }
        };

        // Questions du quiz principal (augmenté à 20 questions)
        const quizQuestions = [
            {
                verse: "مِنْ رَبِّهِمْ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإدغام بغنة"
            },
            {
                verse: "مِنْ بَعْدِ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإقلاب"
            },
            {
                verse: "مِنْ غِلٍّ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإظهار الحلقي"
            },
            {
                verse: "مِنْ تَحْتِهَا",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإخفاء الحقيقي"
            },
            {
                verse: "عَلِيٌّ حَكِيمٌ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإظهار الحلقي"
            },
            {
                verse: "مِنْ نِعْمَةٍ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإدغام بغنة"
            },
            {
                verse: "مِنْ وَرَائِهِمْ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإدغام بغنة"
            },
            {
                verse: "مِنْ قَبْلِ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإخفاء الحقيقي"
            },
            {
                verse: "مِنْ لَدُنْ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بلا غنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بلا غنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإدغام بلا غنة"
            },
            {
                verse: "مِنْ صِرَاطٍ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإخفاء الحقيقي"
            },
            {
                verse: "مِنْ جَنَّةٍ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإخفاء الحقيقي"
            },
            {
                verse: "مِنْ دُونِهِمْ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإخفاء الحقيقي"
            },
            {
                verse: "مِنْ فِيهِ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإخفاء الحقيقي"
            },
            {
                verse: "مِنْ كِتَابٍ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإخفاء الحقيقي"
            },
            {
                verse: "مِنْ مَالٍ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإدغام بغنة"
            },
            {
                verse: "مِنْ يَدٍ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإدغام بغنة"
            },
            {
                verse: "مِنْ عِلْمٍ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإظهار الحلقي"
            },
            {
                verse: "مِنْ حَيْثُ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإظهار الحلقي"
            },
            {
                verse: "مِنْ خَوْفٍ",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإظهار الحلقي"
            },
            {
                verse: "مِنْ هُدًى",
                options: {
                    fr: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"],
                    ar: ["الإظهار الحلقي", "الإدغام بغنة", "الإقلاب", "الإخفاء الحقيقي"]
                },
                correctAnswer: "الإظهار الحلقي"
            }
        ];

        // Questions pour le quiz popup
        const popupQuizQuestions = [
            {
                question: {
                    fr: "Quelle règle s'applique lorsque نْ est suivi de ي?",
                    ar: "ما القاعدة التي تطبق عندما يتبع نْ ي?"
                },
                options: {
                    fr: ["Al-Izhar", "Al-Idgham Ma'al Ghunna", "Al-Iqlab", "Al-Ikhfa'"],
                    ar: ["الإظهار", "الإدغام بغنة", "الإقلاب", "الإخفاء"]
                },
                correctAnswer: "Al-Idgham Ma'al Ghunna"
            },
            {
                question: {
                    fr: "Combien de lettres provoquent Al-Izhar Al-Halqi?",
                    ar: "كم حرفًا يسبب الإظهار الحلقي?"
                },
                options: {
                    fr: ["4", "6", "15", "2"],
                    ar: ["٤", "٦", "١٥", "٢"]
                },
                correctAnswer: "6"
            },
            {
                question: {
                    fr: "Quelle lettre transforme le ن en م dans Al-Iqlab?",
                    ar: "أي حرف يحول النون إلى ميم في الإقلاب?"
                },
                options: {
                    fr: ["ت", "ب", "ي", "ر"],
                    ar: ["ت", "ب", "ي", "ر"]
                },
                correctAnswer: "ب"
            },
            {
                question: {
                    fr: "Quelle est la durée de la ghunna dans Al-Ikhfa'?",
                    ar: "ما هي مدة الغنة في الإخفاء?"
                },
                options: {
                    fr: ["1 temps", "2 temps", "3 temps", "Pas de ghunna"],
                    ar: ["حركة واحدة", "حركتين", "ثلاث حركات", "لا غنة"]
                },
                correctAnswer: "2 temps"
            },
            {
                question: {
                    fr: "Quelles lettres provoquent Al-Idgham Bila Ghunna?",
                    ar: "ما هي الحروف التي تسبب الإدغام بلا غنة?"
                },
                options: {
                    fr: ["ي و", "ل ر", "م ن", "ب ت"],
                    ar: ["ي و", "ل ر", "م ن", "ب ت"]
                },
                correctAnswer: "ل ر"
            },
            {
                question: {
                    fr: "Dans 'مِنْ ثَمَرَةٍ', quelle règle s'applique?",
                    ar: "في 'مِنْ ثَمَرَةٍ'، ما هي القاعدة المطبقة?"
                },
                options: {
                    fr: ["Al-Izhar", "Al-Ikhfa'", "Al-Idgham", "Al-Iqlab"],
                    ar: ["الإظهار", "الإخفاء", "الإدغام", "الإقلاب"]
                },
                correctAnswer: "Al-Ikhfa'"
            },
            {
                question: {
                    fr: "Quelle règle a le plus grand nombre de lettres?",
                    ar: "أي قاعدة لها أكبر عدد من الحروف?"
                },
                options: {
                    fr: ["Al-Izhar", "Al-Idgham", "Al-Ikhfa'", "Al-Iqlab"],
                    ar: ["الإظهار", "الإدغام", "الإخفاء", "الإقلاب"]
                },
                correctAnswer: "Al-Ikhfa'"
            },
            {
                question: {
                    fr: "Comment prononce-t-on نْ suivi de م?",
                    ar: "كيف تنطق نْ متبوعة بم?"
                },
                options: {
                    fr: ["N clair", "M avec ghunna", "N nasal", "L clair"],
                    ar: ["نون واضحة", "ميم مع غنة", "نون أنفية", "لام واضحة"]
                },
                correctAnswer: "M avec ghunna"
            },
            {
                question: {
                    fr: "Quelle règle ne comporte pas de ghunna?",
                    ar: "أي قاعدة لا تحتوي على غنة?"
                },
                options: {
                    fr: ["Al-Idgham Ma'al Ghunna", "Al-Ikhfa'", "Al-Idgham Bila Ghunna", "Al-Iqlab"],
                    ar: ["الإدغام بغنة", "الإخفاء", "الإدغام بلا غنة", "الإقلاب"]
                },
                correctAnswer: "Al-Idgham Bila Ghunna"
            },
            {
                question: {
                    fr: "Quelle est la signification de 'Iqlab'?",
                    ar: "ما معنى 'الإقلاب'?"
                },
                options: {
                    fr: ["Montrer", "Cacher", "Transformer", "Nasaliser"],
                    ar: ["إظهار", "إخفاء", "تحويل", "غنة"]
                },
                correctAnswer: "Transformer"
            }
        ];

        // État de l'application
        let currentLanguage = 'fr';
        let darkMode = false;
        let currentQuestion = 0;
        let score = 0;
        let selectedOption = null;
        let popupCurrentQuestion = 0;
        let popupScore = 0;
        let popupSelectedOption = null;

        // Éléments DOM
        const languageBtn = document.getElementById('language-btn');
        const darkModeBtn = document.getElementById('dark-mode-btn');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const quizContainer = document.getElementById('quiz-container');
        const verseElement = document.getElementById('verse');
        const optionsContainer = document.getElementById('options');
        const feedbackElement = document.getElementById('feedback');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const scoreElement = document.getElementById('score');
        const quizBubble = document.getElementById('quiz-bubble');
        const quizPopup = document.getElementById('quiz-popup');
        const closePopupBtn = document.getElementById('close-popup');
        const popupTitle = document.getElementById('popup-title');
        const popupQuestion = document.getElementById('popup-question');
        const popupOptions = document.getElementById('popup-options');
        const popupFeedback = document.getElementById('popup-feedback');
        const popupPrevBtn = document.getElementById('popup-prev');
        const popupNextBtn = document.getElementById('popup-next');
        const popupScoreElement = document.getElementById('popup-score');
        const arabicInput = document.getElementById('arabic-input');
        const analyzeBtn = document.getElementById('analyze-btn');
        const analysisResults = document.getElementById('analysis-results');
        const resultsContent = document.getElementById('results-content');

        // Initialisation
        function init() {
            translatePage();
            setupEventListeners();
            setupExercises();
        }

        // Traduction de la page
        function translatePage() {
            const lang = translations[currentLanguage];
            
            // Titres et textes
            document.getElementById('title').textContent = lang.title;
            document.getElementById('lessons-title').textContent = lang.lessonsTitle;
            document.getElementById('rule1-title').textContent = lang.rule1Title;
            document.getElementById('rule1-desc').textContent = lang.rule1Desc;
            document.getElementById('rule2-title').textContent = lang.rule2Title;
            document.getElementById('rule2-desc').textContent = lang.rule2Desc;
            document.getElementById('rule3-title').textContent = lang.rule3Title;
            document.getElementById('rule3-desc').textContent = lang.rule3Desc;
            document.getElementById('rule4-title').textContent = lang.rule4Title;
            document.getElementById('rule4-desc').textContent = lang.rule4Desc;
            document.getElementById('rule5-title').textContent = lang.rule5Title;
            document.getElementById('rule5-desc').textContent = lang.rule5Desc;
            startQuizBtn.textContent = lang.startQuizBtn;
            prevBtn.textContent = lang.prevBtn;
            nextBtn.textContent = lang.nextBtn;
            popupTitle.textContent = lang.popupTitle;
            
            // Mettre à jour les visualisations du tanwin
            document.querySelectorAll('.tanwin-visualization').forEach(el => {
                el.style.display = 'none';
            });
            
            if (currentLanguage === 'fr') {
                document.getElementById('rule1-visual-fr').style.display = 'block';
                document.getElementById('rule2-visual-fr').style.display = 'block';
                document.getElementById('rule3-visual-fr').style.display = 'block';
                document.getElementById('rule4-visual-fr').style.display = 'block';
                document.getElementById('rule5-visual-fr').style.display = 'block';
            } else {
                document.getElementById('rule1-visual-ar').style.display = 'block';
                document.getElementById('rule2-visual-ar').style.display = 'block';
                document.getElementById('rule3-visual-ar').style.display = 'block';
                document.getElementById('rule4-visual-ar').style.display = 'block';
                document.getElementById('rule5-visual-ar').style.display = 'block';
            }
            
            // Exercices
            document.getElementById('exercise1-title').textContent = lang.exercise1Title;
            document.getElementById('exercise1-q1').textContent = lang.exercise1Q1;
            document.getElementById('exercise1-q2').textContent = lang.exercise1Q2;
            document.getElementById('exercise1-q3').textContent = lang.exercise1Q3;
            
            // Mettre à jour les options des exercices
            const exercise1Options1 = document.getElementById('exercise1-options1');
            exercise1Options1.innerHTML = '';
            [lang.exercise1Opt1, lang.exercise1Opt2, lang.exercise1Opt3].forEach((opt, index) => {
                const option = document.createElement('div');
                option.className = 'exercise-option';
                option.textContent = opt;
                option.dataset.correct = index === 1 ? 'true' : 'false';
                exercise1Options1.appendChild(option);
            });
            
            const exercise1Options2 = document.getElementById('exercise1-options2');
            exercise1Options2.innerHTML = '';
            [lang.exercise1Opt4, lang.exercise1Opt5, lang.exercise1Opt6].forEach((opt, index) => {
                const option = document.createElement('div');
                option.className = 'exercise-option';
                option.textContent = opt;
                option.dataset.correct = index === 1 ? 'true' : 'false';
                exercise1Options2.appendChild(option);
            });
            
            const exercise1Options3 = document.getElementById('exercise1-options3');
            exercise1Options3.innerHTML = '';
            [lang.exercise1Opt7, lang.exercise1Opt8, lang.exercise1Opt9].forEach((opt, index) => {
                const option = document.createElement('div');
                option.className = 'exercise-option';
                option.textContent = opt;
                option.dataset.correct = index === 1 ? 'true' : 'false';
                exercise1Options3.appendChild(option);
            });
            
            document.getElementById('exercise2-title').textContent = lang.exercise2Title;
            document.getElementById('exercise2-q1').textContent = lang.exercise2Q1;
            document.getElementById('exercise2-q2').textContent = lang.exercise2Q2;
            document.getElementById('exercise2-q3').textContent = lang.exercise2Q3;
            
            const exercise2Options1 = document.getElementById('exercise2-options1');
            exercise2Options1.innerHTML = '';
            [lang.exercise2Opt1, lang.exercise2Opt2, lang.exercise2Opt3].forEach((opt, index) => {
                const option = document.createElement('div');
                option.className = 'exercise-option';
                option.textContent = opt;
                option.dataset.correct = index === 1 ? 'true' : 'false';
                exercise2Options1.appendChild(option);
            });
            
            const exercise2Options2 = document.getElementById('exercise2-options2');
            exercise2Options2.innerHTML = '';
            [lang.exercise2Opt4, lang.exercise2Opt5, lang.exercise2Opt6].forEach((opt, index) => {
                const option = document.createElement('div');
                option.className = 'exercise-option';
                option.textContent = opt;
                option.dataset.correct = index === 1 ? 'true' : 'false';
                exercise2Options2.appendChild(option);
            });
            
            const exercise2Options3 = document.getElementById('exercise2-options3');
            exercise2Options3.innerHTML = '';
            [lang.exercise2Opt7, lang.exercise2Opt8, lang.exercise2Opt9].forEach((opt, index) => {
                const option = document.createElement('div');
                option.className = 'exercise-option';
                option.textContent = opt;
                option.dataset.correct = index === 2 ? 'true' : 'false';
                exercise2Options3.appendChild(option);
            });
            
            document.getElementById('exercise3-title').textContent = lang.exercise3Title;
            document.getElementById('exercise3-q1').textContent = lang.exercise3Q1;
            document.getElementById('exercise3-q2').textContent = lang.exercise3Q2;
            document.getElementById('exercise3-q3').textContent = lang.exercise3Q3;
            
            const exercise3Options1 = document.getElementById('exercise3-options1');
            exercise3Options1.innerHTML = '';
            [lang.exercise3Opt1, lang.exercise3Opt2, lang.exercise3Opt3].forEach((opt, index) => {
                const option = document.createElement('div');
                option.className = 'exercise-option';
                option.textContent = opt;
                option.dataset.correct = index === 1 ? 'true' : 'false';
                exercise3Options1.appendChild(option);
            });
            
            const exercise3Options2 = document.getElementById('exercise3-options2');
            exercise3Options2.innerHTML = '';
            [lang.exercise3Opt4, lang.exercise3Opt5, lang.exercise3Opt6].forEach((opt, index) => {
                const option = document.createElement('div');
                option.className = 'exercise-option';
                option.textContent = opt;
                option.dataset.correct = index === 1 ? 'true' : 'false';
                exercise3Options2.appendChild(option);
            });
            
            const exercise3Options3 = document.getElementById('exercise3-options3');
            exercise3Options3.innerHTML = '';
            [lang.exercise3Opt7, lang.exercise3Opt8, lang.exercise3Opt9].forEach((opt, index) => {
                const option = document.createElement('div');
                option.className = 'exercise-option';
                option.textContent = opt;
                option.dataset.correct = index === 1 ? 'true' : 'false';
                exercise3Options3.appendChild(option);
            });
            
            document.getElementById('exercise4-title').textContent = lang.exercise4Title;
            document.getElementById('exercise4-q1').textContent = lang.exercise4Q1;
            document.getElementById('exercise4-q2').textContent = lang.exercise4Q2;
            document.getElementById('exercise4-q3').textContent = lang.exercise4Q3;
            
            const exercise4Options1 = document.getElementById('exercise4-options1');
            exercise4Options1.innerHTML = '';
            [lang.exercise4Opt1, lang.exercise4Opt2, lang.exercise4Opt3].forEach((opt, index) => {
                const option = document.createElement('div');
                option.className = 'exercise-option';
                option.textContent = opt;
                option.dataset.correct = index === 1 ? 'true' : 'false';
                exercise4Options1.appendChild(option);
            });
            
            const exercise4Options2 = document.getElementById('exercise4-options2');
            exercise4Options2.innerHTML = '';
            [lang.exercise4Opt4, lang.exercise4Opt5, lang.exercise4Opt6].forEach((opt, index) => {
                const option = document.createElement('div');
                option.className = 'exercise-option';
                option.textContent = opt;
                option.dataset.correct = index === 1 ? 'true' : 'false';
                exercise4Options2.appendChild(option);
            });
            
            const exercise4Options3 = document.getElementById('exercise4-options3');
            exercise4Options3.innerHTML = '';
            [lang.exercise4Opt7, lang.exercise4Opt8, lang.exercise4Opt9].forEach((opt, index) => {
                const option = document.createElement('div');
                option.className = 'exercise-option';
                option.textContent = opt;
                option.dataset.correct = index === 1 ? 'true' : 'false';
                exercise4Options3.appendChild(option);
            });
            
            document.getElementById('exercise5-title').textContent = lang.exercise5Title;
            document.getElementById('exercise5-q1').textContent = lang.exercise5Q1;
            document.getElementById('exercise5-q2').textContent = lang.exercise5Q2;
            document.getElementById('exercise5-q3').textContent = lang.exercise5Q3;
            
            const exercise5Options1 = document.getElementById('exercise5-options1');
            exercise5Options1.innerHTML = '';
            [lang.exercise5Opt1, lang.exercise5Opt2, lang.exercise5Opt3].forEach((opt, index) => {
                const option = document.createElement('div');
                option.className = 'exercise-option';
                option.textContent = opt;
                option.dataset.correct = index === 1 ? 'true' : 'false';
                exercise5Options1.appendChild(option);
            });
            
            const exercise5Options2 = document.getElementById('exercise5-options2');
            exercise5Options2.innerHTML = '';
            [lang.exercise5Opt4, lang.exercise5Opt5, lang.exercise5Opt6].forEach((opt, index) => {
                const option = document.createElement('div');
                option.className = 'exercise-option';
                option.textContent = opt;
                option.dataset.correct = index === 1 ? 'true' : 'false';
                exercise5Options2.appendChild(option);
            });
            
            const exercise5Options3 = document.getElementById('exercise5-options3');
            exercise5Options3.innerHTML = '';
            [lang.exercise5Opt7, lang.exercise5Opt8, lang.exercise5Opt9].forEach((opt, index) => {
                const option = document.createElement('div');
                option.className = 'exercise-option';
                option.textContent = opt;
                option.dataset.correct = index === 1 ? 'true' : 'false';
                exercise5Options3.appendChild(option);
            });
            
            // Mettre à jour tous les boutons "Vérifier les réponses"
            document.querySelectorAll('.check-answers').forEach(btn => {
                btn.textContent = lang.exerciseCheck;
            });
            
            // Mettre à jour le texte du bouton de langue
            languageBtn.textContent = currentLanguage === 'fr' ? 'العربية' : 'Français';
            
            // Mettre à jour le texte du bouton mode sombre
            darkModeBtn.textContent = darkMode ? 
                (currentLanguage === 'fr' ? 'Mode Clair' : 'الوضع الفاتح') : 
                (currentLanguage === 'fr' ? 'Mode Sombre' : 'الوضع المظلم');
            
            // Mettre à jour le quiz si actif
            if (!quizContainer.classList.contains('hidden')) {
                updateQuiz();
            }
            
            // Mettre à jour le quiz popup si actif
            if (quizPopup.classList.contains('active')) {
                updatePopupQuiz();
            }
            
            // Mettre à jour l'analyseur de tanwin
            document.getElementById('analyzer-title').textContent = lang.analyzerTitle;
            document.getElementById('analyzer-desc').textContent = lang.analyzerDesc;
            document.getElementById('results-title').textContent = lang.resultsTitle;
            analyzeBtn.textContent = lang.analyzeBtn;
            arabicInput.placeholder = currentLanguage === 'fr' ? "اكتب جملة تحتوي على تنوين أو نون ساكنة..." : "Enter a phrase containing tanwin or nun sakinah...";
            
            // Réinitialiser les écouteurs d'événements pour les options
            setupExercises();
        }

        // Configuration des écouteurs d'événements
        function setupEventListeners() {
            languageBtn.addEventListener('click', toggleLanguage);
            darkModeBtn.addEventListener('click', toggleDarkMode);
            startQuizBtn.addEventListener('click', startQuiz);
            prevBtn.addEventListener('click', prevQuestion);
            nextBtn.addEventListener('click', nextQuestion);
            quizBubble.addEventListener('click', toggleQuizPopup);
            closePopupBtn.addEventListener('click', toggleQuizPopup);
            popupPrevBtn.addEventListener('click', popupPrevQuestion);
            popupNextBtn.addEventListener('click', popupNextQuestion);
            analyzeBtn.addEventListener('click', analyzeTanwin);
        }

        // Configurer les exercices interactifs
        function setupExercises() {
            document.querySelectorAll('.exercise').forEach(exercise => {
                const checkBtn = exercise.querySelector('.check-answers');
                const options = exercise.querySelectorAll('.exercise-option');
                const feedbacks = exercise.querySelectorAll('.exercise-feedback');
                
                options.forEach(option => {
                    option.addEventListener('click', function() {
                        // Désélectionner toutes les options de cette question
                        const questionOptions = this.closest('.exercise-options').querySelectorAll('.exercise-option');
                        questionOptions.forEach(opt => opt.classList.remove('selected'));
                        
                        // Sélectionner cette option
                        this.classList.add('selected');
                        
                        // Masquer le feedback précédent
                        const feedback = this.closest('.exercise-options').nextElementSibling;
                        if (feedback && feedback.classList.contains('exercise-feedback')) {
                            feedback.style.display = 'none';
                        }
                    });
                });
                
                checkBtn.addEventListener('click', function() {
                    const exercise = this.parentElement;
                    const questions = exercise.querySelectorAll('.exercise-question');
                    let allAnswered = true;
                    
                    questions.forEach(question => {
                        const optionsContainer = question.nextElementSibling;
                        const selectedOption = optionsContainer.querySelector('.exercise-option.selected');
                        const feedback = optionsContainer.nextElementSibling;
                        
                        if (!selectedOption) {
                            allAnswered = false;
                            return;
                        }
                        
                        const isCorrect = selectedOption.dataset.correct === "true";
                        
                        feedback.textContent = isCorrect ? 
                            (currentLanguage === 'fr' ? translations.fr.correct : translations.ar.correct) : 
                            (currentLanguage === 'fr' ? translations.fr.incorrect : translations.ar.incorrect);
                        
                        feedback.className = 'exercise-feedback ' + (isCorrect ? 'exercise-correct' : 'exercise-incorrect');
                        feedback.style.display = 'block';
                    });
                    
                    if (!allAnswered) {
                        alert(currentLanguage === 'fr' ? "Veuillez répondre à toutes les questions avant de vérifier." : "الرجاء الإجابة على جميع الأسئلة قبل التحقق.");
                    }
                });
            });
        }

        // Basculer entre les langues
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'fr' ? 'ar' : 'fr';
            translatePage();
            
            // Changer la direction du texte
            document.documentElement.dir = currentLanguage === 'ar' ? 'rtl' : 'ltr';
        }

        // Basculer le mode sombre
        function toggleDarkMode() {
            darkMode = !darkMode;
            document.body.classList.toggle('dark-mode');
            translatePage(); // Mettre à jour le texte du bouton
        }

        // Démarrer le quiz
        function startQuiz() {
            quizContainer.classList.remove('hidden');
            startQuizBtn.classList.add('hidden');
            currentQuestion = 0;
            score = 0;
            updateQuiz();
        }

        // Mettre à jour l'affichage du quiz
        function updateQuiz() {
            const question = quizQuestions[currentQuestion];
            verseElement.textContent = question.verse;
            
            optionsContainer.innerHTML = '';
            question.options[currentLanguage].forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('option');
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => selectOption(index, option));
                optionsContainer.appendChild(optionElement);
            });
            
            scoreElement.textContent = translations[currentLanguage].scoreText + score + '/' + quizQuestions.length;
            feedbackElement.style.display = 'none';
            selectedOption = null;
            
            // Gérer les boutons de navigation
            prevBtn.disabled = currentQuestion === 0;
            nextBtn.textContent = currentQuestion === quizQuestions.length - 1 ? 
                (currentLanguage === 'fr' ? 'Terminer' : 'إنهاء') : 
                translations[currentLanguage].nextBtn;
        }

        // Sélectionner une option
        function selectOption(index, option) {
            // Réinitialiser toutes les options sélectionnées
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Sélectionner la nouvelle option
            document.querySelectorAll('.option')[index].classList.add('selected');
            selectedOption = option;
            
            // Vérifier la réponse
            const question = quizQuestions[currentQuestion];
            const isCorrect = selectedOption === question.correctAnswer;
            
            feedbackElement.textContent = isCorrect ? 
                (currentLanguage === 'fr' ? translations.fr.correct : translations.ar.correct) : 
                (currentLanguage === 'fr' ? `Incorrect. La réponse est: ${question.correctAnswer}` : `خطأ. الإجابة الصحيحة هي: ${question.correctAnswer}`);
            
            feedbackElement.className = 'feedback ' + (isCorrect ? 'correct' : 'incorrect');
            feedbackElement.style.display = 'block';
            
            if (isCorrect && !question.answered) {
                score++;
                question.answered = true;
                scoreElement.textContent = translations[currentLanguage].scoreText + score + '/' + quizQuestions.length;
            }
        }

        // Question précédente
        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                updateQuiz();
            }
        }

        // Question suivante
        function nextQuestion() {
            if (currentQuestion < quizQuestions.length - 1) {
                currentQuestion++;
                updateQuiz();
            } else {
                // Terminer le quiz
                quizContainer.classList.add('hidden');
                startQuizBtn.classList.remove('hidden');
                startQuizBtn.textContent = currentLanguage === 'fr' ? 'Refaire le Quiz' : 'إعادة الاختبار';
                
                // Réinitialiser les questions répondues
                quizQuestions.forEach(q => q.answered = false);
            }
        }

        // Basculer le popup de quiz
        function toggleQuizPopup() {
            quizPopup.classList.toggle('active');
            
            if (quizPopup.classList.contains('active')) {
                popupCurrentQuestion = 0;
                popupScore = 0;
                updatePopupQuiz();
            }
        }

        // Mettre à jour le quiz popup
        function updatePopupQuiz() {
            const question = popupQuizQuestions[popupCurrentQuestion];
            popupQuestion.textContent = question.question[currentLanguage];
            
            popupOptions.innerHTML = '';
            question.options[currentLanguage].forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('exercise-option');
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => selectPopupOption(index, option));
                popupOptions.appendChild(optionElement);
            });
            
            popupScoreElement.textContent = translations[currentLanguage].scoreText + popupScore + '/' + popupQuizQuestions.length;
            popupFeedback.style.display = 'none';
            popupSelectedOption = null;
            
            // Gérer les boutons de navigation
            popupPrevBtn.disabled = popupCurrentQuestion === 0;
            popupNextBtn.textContent = popupCurrentQuestion === popupQuizQuestions.length - 1 ? 
                (currentLanguage === 'fr' ? 'Terminer' : 'إنهاء') : 
                translations[currentLanguage].nextBtn;
        }

        // Sélectionner une option dans le popup
        function selectPopupOption(index, option) {
            // Réinitialiser toutes les options sélectionnées
            document.querySelectorAll('#popup-options .exercise-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Sélectionner la nouvelle option
            document.querySelectorAll('#popup-options .exercise-option')[index].classList.add('selected');
            popupSelectedOption = option;
            
            // Vérifier la réponse
            const question = popupQuizQuestions[popupCurrentQuestion];
            const isCorrect = popupSelectedOption === question.correctAnswer;
            
            popupFeedback.textContent = isCorrect ? 
                (currentLanguage === 'fr' ? translations.fr.correct : translations.ar.correct) : 
                (currentLanguage === 'fr' ? `Incorrect. La réponse est: ${question.correctAnswer}` : `خطأ. الإجابة الصحيحة هي: ${question.correctAnswer}`);
            
            popupFeedback.className = 'exercise-feedback ' + (isCorrect ? 'exercise-correct' : 'exercise-incorrect');
            popupFeedback.style.display = 'block';
            
            if (isCorrect && !question.answered) {
                popupScore++;
                question.answered = true;
                popupScoreElement.textContent = translations[currentLanguage].scoreText + popupScore + '/' + popupQuizQuestions.length;
            }
        }

        // Question précédente dans le popup
        function popupPrevQuestion() {
            if (popupCurrentQuestion > 0) {
                popupCurrentQuestion--;
                updatePopupQuiz();
            }
        }

        // Question suivante dans le popup
        function popupNextQuestion() {
            if (popupCurrentQuestion < popupQuizQuestions.length - 1) {
                popupCurrentQuestion++;
                updatePopupQuiz();
            } else {
                // Terminer le quiz
                const lang = translations[currentLanguage];
                popupQuestion.textContent = lang.popupEnd + popupScore + '/' + popupQuizQuestions.length;
                popupOptions.innerHTML = '';
                popupFeedback.style.display = 'none';
                popupNextBtn.textContent = lang.startQuizBtn;
                
                // Créer un nouvel écouteur qui ne s'exécutera qu'une fois
                const handler = function() {
                    popupQuizQuestions.forEach(q => q.answered = false);
                    popupCurrentQuestion = 0;
                    popupScore = 0;
                    updatePopupQuiz();
                    popupNextBtn.removeEventListener('click', handler);
                };
                
                popupNextBtn.addEventListener('click', handler, { once: true });
            }
        }

        // Analyser le tanwin et nun sakinah dans la phrase
        function analyzeTanwin() {
            const input = arabicInput.value.trim();
            resultsContent.innerHTML = '';
            analysisResults.style.display = 'none';
            
            if (!input) {
                alert(currentLanguage === 'fr' ? "Veuillez entrer une phrase en arabe." : "الرجاء إدخال جملة باللغة العربية.");
                return;
            }
            
            const lang = translations[currentLanguage];
            let resultsHTML = '';
            let foundElements = 0;
            
            // Détecter les tanwins (ـًـٍـٌ) et nun sakinah (نْ)
            for (let i = 0; i < input.length; i++) {
                const currentChar = input[i];
                let elementType = null;
                let elementName = '';
                
                // Vérifier si c'est un tanwin
                if (currentChar in tanwinTypes) {
                    elementType = 'tanwin';
                    elementName = tanwinTypes[currentChar].name[currentLanguage];
                }
                // Vérifier si c'est un nun sakinah (ن suivi de sukun)
                else if (currentChar === 'ن' && i < input.length - 1 && input[i+1] === '\u0652') {
                    elementType = 'nun';
                    elementName = lang.nunSakinah;
                    i++; // Sauter le sukun
                }
                
                if (elementType) {
                    foundElements++;
                    const position = i + 1; // Position basée sur 1 pour l'utilisateur
                    
                    // Trouver la lettre suivante (ignorer les espaces et signes diacritiques)
                    let nextCharIndex = i + 1;
                    while (nextCharIndex < input.length) {
                        const char = input[nextCharIndex];
                        // Ignorer les espaces, signes diacritiques et autres caractères non pertinents
                        if (char.trim() === '' || 
                            char === '\u0652' || // Sukun
                            char === '\u064E' || // Fatha
                            char === '\u064F' || // Damma
                            char === '\u0650' || // Kasra
                            char === '\u0651' || // Shadda
                            char === '\u0670') { // Alif khanjariya
                            nextCharIndex++;
                            continue;
                        }
                        break;
                    }
                    
                    let nextChar = input[nextCharIndex];
                    
                    // Si nous sommes à la fin de la chaîne ou si le caractère suivant est un espace/signe de ponctuation
                    if (!nextChar || nextCharIndex >= input.length) {
                        resultsHTML += `
                            <div class="tanwin-result">
                                <p><strong>${elementName} ${lang[elementType === 'tanwin' ? 'tanwinAtPosition' : 'nunAtPosition']} ${position}</strong></p>
                                <p>${lang.noFollowingLetter}</p>
                            </div>
                        `;
                        continue;
                    }
                    
                    // Trouver la règle qui s'applique
                    const ruleData = tajweedRules[nextChar] || tajweedRules["default"];
                    const rule = ruleData.rule;
                    const explanation = ruleData.explanation[currentLanguage];
                    const visual = ruleData.visual[currentLanguage];
                    
                    resultsHTML += `
                        <div class="tanwin-result">
                            <p><strong>${elementName} ${lang[elementType === 'tanwin' ? 'tanwinAtPosition' : 'nunAtPosition']} ${position}</strong></p>
                            <p>${lang.followingLetter}: ${nextChar}</p>
                            <p>${lang.ruleApplied}: ${rule}</p>
                            <p class="rule-explanation">${explanation}</p>
                            <p><strong>${currentLanguage === 'fr' ? 'Représentation visuelle' : 'التمثيل المرئي'}:</strong> ${visual}</p>
                        </div>
                    `;
                }
            }
            
            if (foundElements === 0) {
                resultsHTML = `<p>${lang.noTanwinFound}</p>`;
            } else {
                resultsHTML = `<p>${foundElements} ${currentLanguage === 'fr' ? 'éléments détectés' : 'عنصر تم اكتشافه'}:</p>` + resultsHTML;
            }
            
            resultsContent.innerHTML = resultsHTML;
            analysisResults.style.display = 'block';
        }

        // Initialiser l'application
        document.addEventListener('DOMContentLoaded', function() {
            init();
        });
    </script>
</body>
</html>